-# Copyright 2012 Twitter, Inc. and others.
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#     http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.

%form{:method => 'post', :action => (@task.evaluation.prod? ? 'https://www.mturk.com/mturk/externalSubmit' : 'http://workersandbox.mturk.com/mturk/externalSubmit')}
  -# This hidden field is for MTurk -- it gets populated by the
  -# turkSetAssignmentID() javascript call below
  %input{:type => 'hidden', :value => '', :name => 'assignmentId', :id => 'assignmentId'}

  - @task.evaluation.template.each do |section|
    .section
      - case section[:type]
      - when :_mc
        - mc_q = @task.evaluation.mc_questions.find_by_order(section[:order])
        - name = 'mc:' + mc_q.id.to_s
        = render :partial => 'mc_question', :locals => {:mc_q => mc_q, :name => name}
      - when :_fr
        - fr_q = @task.evaluation.fr_questions.find_by_order(section[:order])
        - name = 'fr:' + fr_q.id.to_s
        = render :partial => 'fr_question', :locals => {:fr_q => fr_q, :name => name}
      - when :_text
        = render :partial => 'text', :locals => {:content => section[:content], :data => @task.data}
      - when :_header
        = render :partial => 'header', :locals => {:content => section[:content], :data => @task.data}
      - else
        = render :partial => "components/#{section[:type]}", :locals => {:data => resolve_data(section[:data], @task.data)}

  %input.btn.btn-primary{:type => 'submit', :value => 'Submit', :id => 'submitButton'}

  -# Set up MTurk hidden field and javascript validation
  %script{:language => 'Javascript'}
    :plain
      turkSetAssignmentID();
      $('#mturk_form').validate();

